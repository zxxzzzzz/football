import{D as N,A as T,d as v}from"./index-3a46e6fc.js";import{d as V,r as y,g as w,k as j,l as A,c as O,b as a,u as s,w as u,a as m,o as R,e as b,f as E,m as M,s as n,p as r}from"./index-1468e9eb.js";import{_ as x}from"./message.vue_vue_type_script_setup_true_lang-c3386282.js";import{B as D}from"./button-c185e6b6.js";import"./SearchOutlined-ee85ee8c.js";const U=m("div",{class:"bg-white"}," ",-1),q=m("div",{class:"bg-gray-100"}," ",-1),z={class:"flex flex-col"},Q=V({__name:"mobile",setup(F){const i=E(),$=M(),B=y([]);let l;const c=y(),I=w(()=>{var t;return((t=c.value)==null?void 0:t.message1List)||[]}),S=w(()=>{var t;return((t=c.value)==null?void 0:t.message2List)||[]});async function C(){var d,g,p,k,h,_;if($.path!=="/mobile/basketball")return!1;const t=location.origin,e=await(await fetch(`${t}/basketballData/?p=${n.password}&token=${n.token}`)).json();if(e.code!==200){if(r.error((e==null?void 0:e.msg)||"更新出错",20),(e==null?void 0:e.code)===619)return r.info("已停止数据自动更新",10),!1;if((e==null?void 0:e.code)===500&&(d=e==null?void 0:e.data)!=null&&d.token&&(localStorage.setItem("token",(g=e==null?void 0:e.data)==null?void 0:g.token),n.token=(p=e==null?void 0:e.data)==null?void 0:p.token),(e==null?void 0:e.code)===601)return r.info("为了保证账号安全，已停止数据自动更新。刷新页面可开始继续自动更新",10),!1;if(e.code===401)return n.password="",localStorage.setItem("ps",""),n.token="",localStorage.setItem("token",""),console.log("goto login"),i.push({path:"/login"}),!1}return(k=e.data)!=null&&k.matchData&&(r.success(`数据更新 ${(h=e==null?void 0:e.data)!=null&&h.timestamp?"距离当前"+(v().valueOf()-v(e.data.timestamp).valueOf())/1e3+"秒":""}, 在线人数${((_=e==null?void 0:e.data)==null?void 0:_.liveCount)||0}`,5),B.value=e.data.matchData,c.value=e.data,localStorage.setItem("token",e.data.token),n.token=e.data.token),!0}async function f(t,o){try{if(!await t())return}catch{}l=setTimeout(async()=>{try{await f(t,o)}catch{}},o)}j(async()=>{f(async()=>document.hidden?!0:await C(),5*1e3)}),A(()=>{l&&clearTimeout(l)});const L=()=>{i.push({path:"/setting"})};return(t,o)=>(R(),O("div",null,[U,q,a(x,{"message-list":s(I)},null,8,["message-list"]),a(s(N)),a(x,{"message-list":s(S)},null,8,["message-list"]),a(s(T),{offsetBottom:400,style:{position:"absolute",right:"0px"}},{default:u(()=>[m("div",z,[a(s(D),{class:"my-2",onClick:L},{default:u(()=>[b(" 设置")]),_:1}),a(s(D),{class:"my-2",onClick:o[0]||(o[0]=e=>s(i).push("/"))},{default:u(()=>[b(" 足球")]),_:1})])]),_:1})]))}});export{Q as default};
