import{A as C,d as v}from"./index-84722453.js";import{d as D,r as y,g as N,k as T,l as V,c as j,b as n,u as a,w as l,a as u,o as A,e as w,f as L,m as O,s,p as r}from"./index-be385ffc.js";import{_ as R}from"./message.vue_vue_type_script_setup_true_lang-6a1cbac5.js";import{B as b}from"./button-6a8022fd.js";import"./SearchOutlined-9ec4d90b.js";const E=u("div",{class:"bg-white"}," ",-1),M=u("div",{class:"bg-gray-100"}," ",-1),U={class:"flex flex-col"},K=D({__name:"mobile",setup(q){const i=L(),x=O(),$=y([]);let c;const f=y(),B=N(()=>{var t;return((t=f.value)==null?void 0:t.message1List)||[]});async function I(){var d,p,g,k,h,_;if(x.path!=="/mobile/basketball")return!1;const t=location.origin,e=await(await fetch(`${t}/basketballData/?p=${s.password}&token=${s.token}`)).json();if(e.code!==200){if(r.error((e==null?void 0:e.msg)||"更新出错",20),(e==null?void 0:e.code)===619)return r.info("已停止数据自动更新",10),!1;if((e==null?void 0:e.code)===500&&(d=e==null?void 0:e.data)!=null&&d.token&&(localStorage.setItem("token",(p=e==null?void 0:e.data)==null?void 0:p.token),s.token=(g=e==null?void 0:e.data)==null?void 0:g.token),(e==null?void 0:e.code)===601)return r.info("为了保证账号安全，已停止数据自动更新。刷新页面可开始继续自动更新",10),!1;if(e.code===401)return s.password="",localStorage.setItem("ps",""),s.token="",localStorage.setItem("token",""),console.log("goto login"),i.push({path:"/login"}),!1}return(k=e.data)!=null&&k.matchData&&(r.success(`数据更新 ${(h=e==null?void 0:e.data)!=null&&h.timestamp?"距离当前"+(v().valueOf()-v(e.data.timestamp).valueOf())/1e3+"秒":""}, 在线人数${((_=e==null?void 0:e.data)==null?void 0:_.liveCount)||0}`,5),$.value=e.data.matchData,f.value=e.data,localStorage.setItem("token",e.data.token),s.token=e.data.token),!0}async function m(t,o){try{if(!await t())return}catch{}c=setTimeout(async()=>{try{await m(t,o)}catch{}},o)}T(async()=>{m(async()=>document.hidden?!0:await I(),5*1e3)}),V(()=>{c&&clearTimeout(c)});const S=()=>{i.push({path:"/setting"})};return(t,o)=>(A(),j("div",null,[E,M,n(R,{"message1-list":a(B)},null,8,["message1-list"]),n(a(C),{offsetBottom:400,style:{position:"absolute",right:"0px"}},{default:l(()=>[u("div",U,[n(a(b),{class:"my-2",onClick:S},{default:l(()=>[w(" 设置")]),_:1}),n(a(b),{class:"my-2",onClick:o[0]||(o[0]=e=>a(i).push("/"))},{default:l(()=>[w(" 足球")]),_:1})])]),_:1})]))}});export{K as default};
