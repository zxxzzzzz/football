import{A as N,d as v}from"./index-4667a0d2.js";import{d as T,r as y,g as w,k as V,l as j,c as A,b as n,u as o,w as u,a as m,o as O,e as b,f as R,m as E,s as a,p as r}from"./index-77876596.js";import{_ as x}from"./message.vue_vue_type_script_setup_true_lang-e30924ca.js";import{B as $}from"./button-1d61f7b8.js";import"./SearchOutlined-94c1cae6.js";const M=m("div",{class:"bg-white"}," ",-1),U=m("div",{class:"bg-gray-100"}," ",-1),q={class:"flex flex-col"},P=T({__name:"mobile",setup(z){const i=R(),B=E(),I=y([]);let l;const c=y(),S=w(()=>{var t;return((t=c.value)==null?void 0:t.message1List)||[]}),C=w(()=>{var t;return((t=c.value)==null?void 0:t.message2List)||[]});async function D(){var d,g,p,k,h,_;if(B.path!=="/mobile/basketball")return!1;const t=location.origin,e=await(await fetch(`${t}/basketballData/?p=${a.password}&token=${a.token}`)).json();if(e.code!==200){if(r.error((e==null?void 0:e.msg)||"更新出错",20),(e==null?void 0:e.code)===619)return r.info("已停止数据自动更新",10),!1;if((e==null?void 0:e.code)===500&&(d=e==null?void 0:e.data)!=null&&d.token&&(localStorage.setItem("token",(g=e==null?void 0:e.data)==null?void 0:g.token),a.token=(p=e==null?void 0:e.data)==null?void 0:p.token),(e==null?void 0:e.code)===601)return r.info("为了保证账号安全，已停止数据自动更新。刷新页面可开始继续自动更新",10),!1;if(e.code===401)return a.password="",localStorage.setItem("ps",""),a.token="",localStorage.setItem("token",""),console.log("goto login"),i.push({path:"/login"}),!1}return(k=e.data)!=null&&k.matchData&&(r.success(`数据更新 ${(h=e==null?void 0:e.data)!=null&&h.timestamp?"距离当前"+(v().valueOf()-v(e.data.timestamp).valueOf())/1e3+"秒":""}, 在线人数${((_=e==null?void 0:e.data)==null?void 0:_.liveCount)||0}`,5),I.value=e.data.matchData,c.value=e.data,localStorage.setItem("token",e.data.token),a.token=e.data.token),!0}async function f(t,s){try{if(!await t())return}catch{}l=setTimeout(async()=>{try{await f(t,s)}catch{}},s)}V(async()=>{f(async()=>document.hidden?!0:await D(),5*1e3)}),j(()=>{l&&clearTimeout(l)});const L=()=>{i.push({path:"/setting"})};return(t,s)=>(O(),A("div",null,[M,U,n(x,{"message-list":o(S)},null,8,["message-list"]),n(x,{"message-list":o(C)},null,8,["message-list"]),n(o(N),{offsetBottom:400,style:{position:"absolute",right:"0px"}},{default:u(()=>[m("div",q,[n(o($),{class:"my-2",onClick:L},{default:u(()=>[b(" 设置")]),_:1}),n(o($),{class:"my-2",onClick:s[0]||(s[0]=e=>o(i).push("/"))},{default:u(()=>[b(" 足球")]),_:1})])]),_:1})]))}});export{P as default};
